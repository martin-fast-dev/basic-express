<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/member.css">
    <link rel="stylesheet" href="css/status.css">
    <meta name="theme-color" content="#fad7dc" />
  </head>
  <body>
    <div class="membersWrapper">
      <a class="backButton" href="/">
        <img class="backButtonIcon" src="/images/arrow-back.png" />
      </a>
      <% members.map(member => { %>
          <div class="memberWrapper">
            <div id="infoWrapper" class="infoWrapper imageButton tiltButton">
              <a class="member" href="<%=`/members/${member._id}`%>">
                <img class="avatarImg" src="<%= member.avatar %>" />
              </a>
            </div>
            <div class="heartsArray">
            <% for(let i = 0; i < member.hearts; i++) { %>
              <button
                class="imageButton heartButton tiltButton"
                onclick="removeHeart('<%=member._id %>', '<%=member.hearts %>')"
              >
                <img draggable="false" class="heartImg" src=<%=`/images/${member.icon}.png` %> />
              </button>
            <% } %>
            <button
              class="imageButton heartButton tiltButton"
              onclick="addHeart('<%=member._id %>', '<%=member.hearts %>')"
            >
              <img draggable="false" class="heartImg addButton" src=<%=`/images/add-${member.icon}.png` %> />
            </button>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
  </body>
  <script>
    const addHeart = (id, hearts) => {
      const  msg = {
        id,
        hearts: Number(hearts) + 1
      };
      socket.send(JSON.stringify(msg));
    };

    const removeHeart = (id, hearts) => {
      const  msg = {
        id,
        hearts: Number(hearts) - 1
      };
      socket.send(JSON.stringify(msg));
    };

    // Create WebSocket connection.
    const socket = new WebSocket('ws://fas10.se:8080', 'http'); //TODO Dont work! Need certificat or something

    // Connection opened
    socket.addEventListener('open', function (event) {
      console.log('Connected to WebSocket server!');
    });

    // Listen for messages
    socket.addEventListener('message', function (event) {
      const { status, message } = JSON.parse(event.data);

      if (status.acknowledged && status.modifiedCount > 0) {
        location.reload();
      }
    });
  </script>
</html>
