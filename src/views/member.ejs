<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="/css/member.css">
  </head>
  <body>
    <form  class="memberWrapper" action="" method="post" id="myForm">
      <div id="infoWrapper" class="infoWrapper">
        <img class="avatarImg" src="<%= member.avatar %>" />
        <p class="username"><%=member.username%></p>
      </div>
      <div class="hearts">
      <% for(let i = 0; i < member.hearts; i++) { %>
        <button type="submit" class="heartButton" formaction="/status/remove">
          <img class="heartImg" src="/images/pink-heart.png" />
        </button>
      <% } %>
      <button type="submit" class="heartButton" formaction="/status/add">
        <img class="heartImg" src="/images/pink-hearts.png" />
      </button>
      </div>
      <input type="hidden" name="id" value="<%= member._id %>" />
      <input type="hidden" name="hearts" value="<%= member.hearts %>" />
      <input type="hidden" name="route" value="<%=`/members/${member._id}`%>" />
    </form>

    <form
      class="memberWrapper"
      name="save-member"
      action="/members/save-member"
      id="editModal"
      method="post"
      style="display:none;"
    >
      <img id="avatarImg" class="avatarImg" src="<%=member ? member.avatar : ''%>" />
      <div class="modalInput">
        <input type="file" name="avatar" id="avatarInput" accept="image/png, image/jpeg" onchange="setImage(this)" />
        <input type="text" name="username" id="username" value="<%=member ? member.username : ''%>" />
        <input type="hidden" name="id" id="id" value="<%=member ? member._id : ''%>" />
        <button class="saveButton" type="submit">
          <img class="saveImage" src="/images/cloud.png" />
        </button>
      </div>
      <div id="modalClose">
        <img class="closeButton" src="/images/close.png" />
      </div>
    </form>

    <script>
      function setImage(input) {
        if (input.files && input.files[0]) {
          const img = document.getElementById("avatarImg");
          img.src = `/images/${input.files[0].name}`;
        }
      }
      function toggleModal() {
        const x = document.getElementById("editModal");
        if (x.style.display === "none") {
          x.style.display = "flex";
        } else {
          x.style.display = "none";
        }
       };
       const avatarInput = document.getElementById("avatarImg");
      const infoWrapper = document.getElementById("infoWrapper");
      const modalClose = document.getElementById("modalClose");
      avatarInput.onchange = () => setImage();
      infoWrapper.onclick = () => toggleModal();
      modalClose.onclick = () => toggleModal();
      </script>
  </body>
</html>
